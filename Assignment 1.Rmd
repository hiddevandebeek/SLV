---
title: "SLV Assignment 1"
author: "Hidde, Ilya, Parisa, & Pim"
date: '2023-09-21'
output: html_document
---

# Exploratory Data Analysis

```{r setup, include=FALSE,comment=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(magrittr)
library(psych)
library(mice)
library(ggplot2)
library(ggthemes)
library(corrplot)
```

### Part 1. Introduction

```{r, include=FALSE}
data <- read.csv("Clean Data_pakwheels.csv")
data %>% head
```

The dataset under consideration provides a comprehensive look at car listings available on a sales platform. Comprising various makes, models, and years, the dataset serves as a rich source for understanding trends and patterns in the car market. The data contains 14 attributes, each contributing a unique aspect to the information. The dataset can serve multiple analytical objectives. Whether the goal is to understand market trends, buyer preferences, or pricing strategies, the diverse set of attributes allows for a broad range of queries and visualizations.  

This assignment is structured as follows: In the second part, we will tidy and summarize our data, making it possible to further process it. In part 3, we take a first look at some initial descriptive statistics and visualizations. This will give us an insight into interesting questions. In part 4, we provide graphs, which visualize our conclusions. Each part is accompanied with a discussion explaining what was done and how it helps to find answers for specified questions.

### Part 2. Data wrangling

#### Data Type

```{r, include=FALSE}
str(data)
```

all columns were imported as data types that we expected but we can change the registration status to factor type.

```{r, include=FALSE}
#Assessing missing data
md.pattern(data)
```

The md.pattern shows that there is not any missing values in this dataset.

```{r}
### Create a new variable "Age" based on the difference between Model.Year and the current year
current_year <- as.integer(format(Sys.Date(), "%Y"))
data <- data %>%
  mutate(Age = current_year - Model.Year)
```

```{r}
head(data)
```

#### Group and summarize data:

calculate the average price of cars by Company.Name.

```{r}
summarized_data <- data %>%
  group_by(Company.Name) %>%
  summarise(Avg_Price = mean(Price)) %>%
  arrange(desc(Avg_Price))  # Sort by Avg_Price in descending order

print(summarized_data)
```

As it can be seen, Porshe has the highest average price, while Adam has the lowest.

#### Data Aggregation:

Aggregate data to calculate summary statistics for multiple variables simultaneously: calculate the mean Mileage and Engine.Capacity by Company.Name.

```{r}
aggregated_data <- data %>%
  group_by(Company.Name) %>%
  summarise(
    Avg_Mileage = mean(Mileage),
    Avg_Engine_Capacity = mean(Engine.Capacity)
  ) %>%
  arrange(desc(Avg_Engine_Capacity)) 
print(aggregated_data)
```

In terms of average engine capacity, Hummer, Range and Jeep take first three positions, respectively.

### Part 3. Descriptive statistics

We group the data by "Company.Name.", then calculate various summary statistics for the "Price" column within each company, including the mean, median, minimum, maximum, and total count of cars. Then, we arrange the results in descending order of average price.

```{r}
result <- data %>%
  group_by(Company.Name) %>%
  summarise(
    Avg_Price = mean(Price, na.rm = TRUE),
    Median_Price = median(Price, na.rm = TRUE),
    Min_Price = min(Price, na.rm = TRUE),
    Max_Price = max(Price, na.rm = TRUE),
    Total_Cars = n()
  ) %>%
  arrange(desc(Avg_Price))

# Print the resulting summary
print(result)
```

Among the most expensive models are the companies which do not have many cars on the market in total. As expected, Porshe, Hummer, Range, Jaguar and Lexus are presented in top-5. Later on it the list, they are accompanied by Audi, BMW and Mercedes. An interesting observation is that, the more cars are presented, the lower the median price is.

### Part 4. Exploratory plots

```{r}
ggplot(data, aes(x = `Company.Name`)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Frequency of Car Companies") +
  xlab("Car Company") +
  ylab("Frequency")
```

As it can be see on the graph, the market is heavily skewed in favor of Asian car producers, mostly related to Japan (Honda, Subaru, Suzuki, Toyota, Daihatsu), which makes total sense, taking market location into account. Car producers traditional for Europe and North America are barely presented on the market, mostly - in the upper segment, where the companies such as Mercedes can be seen.

```{r}
ggplot(data, aes(x = Price)) +
  geom_histogram(binwidth = 250000, fill = "skyblue", alpha = 0.7) + 
  ggtitle("Histogram of Car Prices") +
  xlab("Price") +
  ylab("Frequency") +
  scale_x_continuous(
    breaks = seq(0, 10000000, by = 500000),  
    limits = c(0, 10000000)  
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  
```

As it can be seen, Car pricing presents a normal distribution skewed to the right. Most of the cars can be seen in an average price segment, with cheap cars having almost similar price. For the upper segment of the market the citation is directly the opposite, such as the pricing can vary a lot.  

```{r}
ggplot(data, aes(x = Mileage, y = Price, color = as.factor(Model.Year))) +
  geom_point() +
  ggtitle("Scatter Plot of Mileage vs Price (Pakistani Rupee)") +
  xlab("Mileage") +
  ylab("Price (Pakistani Rupee)") +
  scale_y_continuous(labels = scales::comma_format()) +
  theme(axis.text.y = element_text(size = 10)) +
  scale_color_discrete(name = "Years") +
  labs(color = "Years")
```

As it was expected, the relationship between average price, model year and mileage can be seen. Clearly, the smaller the mileage and the newer the model is, the higher the price. Interestingly, there are several cars presented in the dataframe with extremely high (>500000) mileage. It does not seem, however, that they can significantly affect outcomes in case data is used to run the model. 

```{r}
ggplot(data, aes(x = as.factor(Model.Year), y = Price, fill = as.factor(Model.Year))) +
  geom_boxplot() +
  ggtitle("Box Plot of Model Year vs Price (Pakistani Rupee)") +
  xlab("Years") +
  ylab("Price (Pakistani Rupee)") +
  scale_y_continuous(labels = scales::comma_format(), breaks = seq(0, 80000000, by = 4000000)) +
  scale_fill_discrete(name = "Years") +
  labs(fill = "Years") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "none")
```

Box plot confirms what was said before about the relationship between model year and the price. It is important to mention, however, that since the size of the dataframe is relatively large and pricing does not really tend to have a large variance, we can see a lot of outliers for each year.

Now, lets try only looking at Honda, Suzuki and Toyota and their top performing model

```{r, include=FALSE}
filtered_df <- data %>% filter(`Company.Name` %in% c("Honda", "Suzuki", "Toyota"))

model_counts <- filtered_df %>%
  group_by(`Company.Name`, `Model.Name`) %>%
  summarise(count = n()) %>%
  arrange(`Company.Name`, desc(count))

top_models <- model_counts %>%
  group_by(`Company.Name`) %>%
  slice_head(n = 3)

final_filtered_df <- filtered_df %>%
  semi_join(top_models, by = c("Company.Name", "Model.Name"))
```
```{r}
ggplot(filtered_df, aes(x = Mileage, y = Price, color = Company.Name)) +
  geom_point() +
  ggtitle("Scatter Plot of Mileage vs Price (Pakistani Rupee)") +
  scale_y_continuous(labels = scales::comma_format(), breaks = seq(0, 80000000, by = 4000000))

ggplot(final_filtered_df, aes(x = Mileage, y = Price, color = Company.Name)) +
  geom_point() +
  ggtitle("Scatter Plot of Mileage vs Price (Pakistani Rupee)") +
  scale_y_continuous(labels = scales::comma_format(), breaks = seq(0, 8000000, by = 400000))
```
 
On these graphs, we can see 2 different scaling of the same graph for the Mileage vs Price for 3 models. As it can be seen, in a ascending order by the price, they can be placed as: Suzuki, Honda, Toyota.   
 
Finally, lets examine Mileage vs Price for the models which are the most popular ones: Honda, Suzuki, and Toyota.

```{r}
ggplot(final_filtered_df, aes(x = Price, y = Mileage, color = `Model.Name`)) +
  geom_smooth(method = "lm", se = TRUE) +  # Linear regression lines
  ggtitle("Scatter Plot of Mileage vs Price for Top 3 Models of Honda, Suzuki, and Toyota") +
  labs(color = "Model Name") +
  facet_wrap(~ `Company.Name`, scales = "free") +
  theme_minimal() +
  scale_x_continuous(labels = scales::comma_format(scale = 1e-6)) + 
  scale_y_continuous(labels = scales::comma_format()) +
  xlab("Price (in millions of Pakistani Rupee)") +  
  ylab("Mileage")  
```

The trends seen here are the same in Mileage & Price relationship for all the most popular car models. Intresting thing is, however, some models get older slightly faster than the other ones.

### Part 5. Explanation

Our Exploratory analysis showed the consistency of the dataframe and its relevance for those who can be interested in the car market analysis. Dataframe has no missing observations, but has quite a lot of outliers, mostly because of its size and a small variance across different grouping factors. We calculated descriptive statistics and built several exploratory plots, describing which information can be explored, using the data. The explanation for each of the graphs is provided below them. Overall, it can be concluded that the data is suitable for a more complex analytic approaches.    
