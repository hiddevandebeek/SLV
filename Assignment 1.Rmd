---
title: "SLV Assignment 1"
author: "Hidde, Ilya, Parisa, & Pim"
date: '2023-09-21'
output: html_document
---

# Exploratory Data Analysis

```{r setup, include=FALSE,comment=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(magrittr)
library(psych)
library(mice)
library(ggplot2)
library(ggthemes)
library(corrplot)
```

### Part 1. Introduction

```{r, include=FALSE}
data <- read.csv("Clean Data_pakwheels.csv")
data %>% head
```

The dataset under consideration provides a comprehensive look at car listings available on a sales platform. Comprising various makes, models, and years, the dataset serves as a rich source for understanding trends and patterns in the car market. The data contains 14 attributes, each contributing a unique aspect to the information. The dataset can serve multiple analytical objectives. Whether the goal is to understand market trends, buyer preferences, or pricing strategies, the diverse set of attributes allows for a broad range of queries and visualizations.  

This assignment is structured as follows: In the second part, we will tidy and summarize our data, making it possible to further process it. In part 3, we take a first look at some initial descriptive statistics and visualizations. This will give us an insight into interesting questions. In part 4, we provide graphs, which visualize our conclusions. Each part is accompanied with a discussion explaining what was done and how it helps to find answers for specified questions.

### Part 2. Data wrangling

#### Data Type

```{r, include=FALSE}
str(data)
```

all columns were imported as data types that we expected but we can change the registration status to factor type.

```{r, include=FALSE}
#Assessing missing data

md.pattern(data)
```

The md.pattern shows that there is not any missing values in this dataset.

```{r}
### Create a new variable "Age" based on the difference between Model.Year and the current year
current_year <- as.integer(format(Sys.Date(), "%Y"))
data <- data %>%
  mutate(Age = current_year - Model.Year)
```

```{r}
head(data)
```

#### Group and summarize data:

calculate the average price of cars by Company.Name.

```{r}
summarized_data <- data %>%
  group_by(Company.Name) %>%
  summarise(Avg_Price = mean(Price)) %>%
  arrange(desc(Avg_Price))  # Sort by Avg_Price in descending order

print(summarized_data)
```

#### Data Aggregation:

Aggregate data to calculate summary statistics for multiple variables simultaneously: calculate the mean Mileage and Engine.Capacity by Company.Name.

```{r}
aggregated_data <- data %>%
  group_by(Company.Name) %>%
  summarise(
    Avg_Mileage = mean(Mileage),
    Avg_Engine_Capacity = mean(Engine.Capacity)
  )
print(aggregated_data)
```

### Part 3. Descriptive statistics

We group the data by "Company.Name.", then calculate various summary statistics for the "Price" column within each company, including the mean, median, minimum, maximum, and total count of cars. Then, we arrange the results in descending order of average price.

```{r}
result <- data %>%
  group_by(Company.Name) %>%
  summarise(
    Avg_Price = mean(Price, na.rm = TRUE),
    Median_Price = median(Price, na.rm = TRUE),
    Min_Price = min(Price, na.rm = TRUE),
    Max_Price = max(Price, na.rm = TRUE),
    Total_Cars = n()
  ) %>%
  arrange(desc(Avg_Price))

# Print the resulting summary
print(result)
```

### Part 4. Exploratory plots

```{r}
ggplot(data, aes(x = `Company.Name`)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Frequency of Car Companies") +
  xlab("Car Company") +
  ylab("Frequency")
```
```{r}
ggplot(data, aes(x = Price)) +
  geom_histogram(binwidth = 250000, fill = "skyblue", alpha = 0.7) + 
  ggtitle("Histogram of Car Prices") +
  xlab("Price") +
  ylab("Frequency") +
  scale_x_continuous(
    breaks = seq(0, 10000000, by = 500000),  
    limits = c(0, 10000000)  
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  
```
```{r}
ggplot(data, aes(x = Mileage, y = Price, color = as.factor(Model.Year))) +
  geom_point() +
  ggtitle("Scatter Plot of Mileage vs Price (Pakistani Rupee)") +
  xlab("Mileage") +
  ylab("Price (Pakistani Rupee)") +
  scale_y_continuous(labels = scales::comma_format()) +
  theme(axis.text.y = element_text(size = 10)) +
  scale_color_discrete(name = "Years") +
  labs(color = "Years")
```
```{r}
ggplot(data, aes(x = as.factor(Model.Year), y = Price, fill = as.factor(Model.Year))) +
  geom_boxplot() +
  ggtitle("Box Plot of Model Year vs Price (Pakistani Rupee)") +
  xlab("Years") +
  ylab("Price (Pakistani Rupee)") +
  scale_y_continuous(labels = scales::comma_format(), breaks = seq(0, 80000000, by = 4000000)) +
  scale_fill_discrete(name = "Years") +
  labs(fill = "Years") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "none")
```

Only looking at Honda, Suzuki and Toyota and their top performing model

```{r}
filtered_df <- data %>% filter(`Company.Name` %in% c("Honda", "Suzuki", "Toyota"))

model_counts <- filtered_df %>%
  group_by(`Company.Name`, `Model.Name`) %>%
  summarise(count = n()) %>%
  arrange(`Company.Name`, desc(count))

top_models <- model_counts %>%
  group_by(`Company.Name`) %>%
  slice_head(n = 3)

final_filtered_df <- filtered_df %>%
  semi_join(top_models, by = c("Company.Name", "Model.Name"))
```



```{r}
ggplot(filtered_df, aes(x = Mileage, y = Price, color = Company.Name)) +
  geom_point() +
  ggtitle("Scatter Plot of Mileage vs Price (Pakistani Rupee)") +
  scale_y_continuous(labels = scales::comma_format(), breaks = seq(0, 80000000, by = 4000000))

ggplot(final_filtered_df, aes(x = Mileage, y = Price, color = Company.Name)) +
  geom_point() +
  ggtitle("Scatter Plot of Mileage vs Price (Pakistani Rupee)") +
  scale_y_continuous(labels = scales::comma_format(), breaks = seq(0, 8000000, by = 400000))
```
 
Example Final plot

```{r}
ggplot(final_filtered_df, aes(x = Price, y = Mileage, color = `Model.Name`)) +
  geom_smooth(method = "lm", se = TRUE) +  # Linear regression lines
  ggtitle("Scatter Plot of Mileage vs Price for Top 3 Models of Honda, Suzuki, and Toyota") +
  labs(color = "Model Name") +
  facet_wrap(~ `Company.Name`, scales = "free") +
  theme_minimal() +
  scale_x_continuous(labels = scales::comma_format(scale = 1e-6)) + 
  scale_y_continuous(labels = scales::comma_format()) +
  xlab("Price (in millions of Pakistani Rupee)") +  
  ylab("Mileage")  
```

### Part 5. Explanation

explain what you did and why (maximum 5 paragraphs total) if applicable, note findings such as missingness, outliers or unlikely values or group differences, etc.
